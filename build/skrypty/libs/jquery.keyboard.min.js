/*! Data kompilacji: Tue Jul 28 2015 11:01:42 */
!function(a){a.keyboard=function(b,c){var d,e=this;e.version="1.19.3",e.$el=a(b),e.el=b,e.$el.data("keyboard",e),e.init=function(){e.settings=c||{},e.options=d=a.extend(!0,{},a.keyboard.defaultOptions,c),e.shiftActive=e.altActive=e.metaActive=e.sets=e.capsLock=!1,e.rows=["","-shift","-alt","-alt-shift"],a('<!--[if lte IE 8]><script>jQuery("body").addClass("oldie");</script><![endif]--><!--[if IE]><script>jQuery("body").addClass("ie");</script><![endif]-->').appendTo("body").remove(),e.msie=a("body").hasClass("oldie"),e.allie=a("body").hasClass("ie"),e.inPlaceholder=e.$el.attr("placeholder")||"",e.watermark="undefined"!=typeof document.createElement("input").placeholder&&""!==e.inPlaceholder,e.repeatTime=1e3/(d.repeatRate||20),d.preventDoubleEventTime=d.preventDoubleEventTime||100,e.isOpen=!1,e.wheel=a.isFunction(a.fn.mousewheel),e.alwaysAllowed=[20,33,34,35,36,37,38,39,40,45,46],e.$keyboard=[],d.position.orig_at=d.position.at,e.temp=a('<div style="height:0px;width:0px;overflow:hidden;"><input type="text" value="testing"></div>').insertAfter(e.el),e.temp.find("input").caret(3,3),e.checkCaret=d.lockInput||3!==e.temp.find("input").hide().show().caret().start,e.temp.remove(),e.last={start:0,end:0,key:"",val:"",keyset:[!1,!1,!1]},e.temp=["",0,0],a.each("initialized beforeVisible visible hidden canceled accepted beforeClose".split(" "),function(b,c){a.isFunction(d[c])&&e.$el.bind(c+".keyboard",d[c])}),d.alwaysOpen&&(d.stayOpen=!0),a(document).bind(["mousedown","keyup","touchstart","checkkeyboard",""].join(".keyboard "),function(b){e.opening||(e.escClose(b),b.target&&a(b.target).hasClass("ui-keyboard-input")&&(b=a(b.target).data("keyboard"),b===e&&b.options.openOn&&b.focusOn()))}),e.$el.addClass("ui-keyboard-input "+d.css.input).attr({"aria-haspopup":"true",role:"textbox"}),(e.$el.is(":disabled")||e.$el.attr("readonly")&&!e.$el.hasClass("ui-keyboard-lockedinput"))&&e.$el.addClass("ui-keyboard-nokeyboard"),d.openOn&&e.$el.bind(d.openOn+".keyboard",function(){e.focusOn()}),e.watermark||""!==e.$el.val()||""===e.inPlaceholder||""===e.$el.attr("placeholder")||e.$el.addClass("ui-keyboard-placeholder").val(e.inPlaceholder),e.$el.trigger("initialized.keyboard",[e,e.el]),d.alwaysOpen&&e.reveal()},e.setCurrent=function(){a(".ui-keyboard-has-focus").removeClass("ui-keyboard-has-focus"),a(".ui-keyboard-input-current").removeClass("ui-keyboard-input-current"),e.$el.addClass("ui-keyboard-input-current"),e.$keyboard.addClass("ui-keyboard-has-focus"),e.isCurrent(!0),e.isOpen=!0},e.isCurrent=function(b){var c=a.keyboard.currentKeyboard||!1;return b?c=a.keyboard.currentKeyboard=e.el:!1===b&&c===e.el&&(c=a.keyboard.currentKeyboard=""),c===e.el},e.isVisible=function(){return e.$keyboard&&e.$keyboard.length?e.$keyboard.is(":visible"):!1},e.focusOn=function(){e.$el.is(":visible")&&setTimeout(function(){if(!/(number|email)/i.test(e.el.type)){var a=e.$el.caret();e.last.start=a.start,e.last.end=a.end}},20),e.isVisible()||(clearTimeout(e.timer),e.reveal()),d.alwaysOpen&&e.setCurrent()},e.reveal=function(b){return e.opening=!0,a(".ui-keyboard").not(".ui-keyboard-always-open").remove(),b&&(e.isOpen=!1,e.last.value=e.$preview&&e.$preview.val()||"",e.$keyboard.length&&(e.$keyboard.remove(),e.$keyboard=[],e.shiftActive=e.altActive=e.metaActive=!1)),e.$el.is(":disabled")||e.$el.attr("readonly")&&!e.$el.hasClass("ui-keyboard-lockedinput")?void e.$el.addClass("ui-keyboard-nokeyboard"):(e.$el.removeClass("ui-keyboard-nokeyboard"),d.openOn&&e.$el.unbind(d.openOn+".keyboard"),e.$keyboard&&(!e.$keyboard||e.$keyboard.length&&!a.contains(document.body,e.$keyboard[0]))||e.startup(),e.watermark||e.el.value!==e.inPlaceholder||e.$el.removeClass("ui-keyboard-placeholder").val(""),e.originalContent=e.$el.val(),e.$preview.val(b?e.last.value:e.originalContent),d.acceptValid&&e.checkValid(),d.resetDefault&&(e.shiftActive=e.altActive=e.metaActive=!1,e.showKeySet()),d.appendLocally||"body"!==d.appendTo||e.$keyboard.css({position:"absolute",left:0,top:0}),e.$el.trigger("beforeVisible.keyboard",[e,e.el]),e.setCurrent(),e.$keyboard.show(),d.usePreview&&e.msie&&("undefined"==typeof e.width&&(e.$preview.hide(),e.width=Math.ceil(e.$keyboard.width()),e.$preview.show()),e.$preview.width(e.width)),e.position=d.position,a.ui&&a.ui.position&&!a.isEmptyObject(e.position)&&(e.position.of=e.position.of||e.$el.data("keyboardPosition")||e.$el,e.position.collision=e.position.collision||"flipfit flipfit",d.position.at=d.usePreview?d.position.orig_at:d.position.at2,e.$keyboard.position(e.position)),e.checkDecimal(),e.lineHeight=parseInt(e.$preview.css("lineHeight"),10)||parseInt(e.$preview.css("font-size"),10)+4,d.caretToEnd&&(e.last.start=e.last.end=e.originalContent.length),e.allie&&(0===e.last.end&&0<e.last.start&&(e.last.end=e.last.start),0>e.last.start&&(e.last.start=e.last.end=e.originalContent.length)),setTimeout(function(){e.opening=!1,d.initialFocus&&e.$preview.focus().caret(e.last),e.$el.trigger("visible.keyboard",[e,e.el])},10),e)},e.updateLanguage=function(){var b=a.keyboard.layouts,c=d.language||b[d.layout]&&b[d.layout].lang&&b[d.layout].lang||[d.language||"en"],f=a.keyboard.language,c=c[0].split("-")[0];d.display=a.extend(!0,{},f.en.display,f[c]&&f[c].display||{},e.settings.display),d.combos=a.extend(!0,{},f.en.combos,f[c]&&f[c].combos||{},e.settings.combos),d.wheelMessage=f[c]&&f[c].wheelMessage||f.en.wheelMessage,d.rtl=b[d.layout]&&b[d.layout].rtl||f[c]&&f[c].rtl||!1,e.regex=f[c]&&f[c].comboRegex||a.keyboard.comboRegex,e.decimal=/^\./.test(d.display.dec),e.$el.toggleClass("rtl",d.rtl).css("direction",d.rtl?"rtl":"")},e.startup=function(){e.$preview=e.$el,e.$keyboard&&e.$keyboard.length||("custom"===d.layout&&(d.layoutHash="custom"+e.customHash()),e.layout="custom"===d.layout?d.layoutHash:d.layout,e.updateLanguage(),"undefined"==typeof a.keyboard.builtLayouts[e.layout]&&(a.isFunction(d.create)&&d.create(e),e.$keyboard.length||e.buildKeyboard()),e.$keyboard=a.keyboard.builtLayouts[e.layout].$keyboard.clone(),d.usePreview?(d.position.at=d.position.orig_at,e.$preview=e.$el.clone(!1).removeAttr("id").removeClass("ui-keyboard-placeholder ui-keyboard-input").addClass("ui-keyboard-preview "+d.css.input).removeAttr("aria-haspopup").attr("tabindex","-1").show(),"number"==e.$preview.attr("type")&&e.$preview.attr("type","text"),a("<div />").addClass("ui-keyboard-preview-wrapper").append(e.$preview).prependTo(e.$keyboard)):a.isEmptyObject(d.position)||(d.position.at=d.position.at2)),e.preview=e.$preview[0],e.$decBtn=e.$keyboard.find(".ui-keyboard-dec"),(d.enterNavigation||"TEXTAREA"===e.el.tagName)&&e.alwaysAllowed.push(13),d.lockInput&&e.$preview.addClass("ui-keyboard-lockedinput").attr({readonly:"readonly"}),e.bindKeyboard(),e.$keyboard.appendTo(d.appendLocally?e.$el.parent():d.appendTo||"body"),e.bindKeys(),d.reposition&&a.ui&&a.ui.position&&"body"==d.appendTo&&a(window).bind("resize.keyboard",function(){e.isVisible()&&e.$keyboard.position(e.position)})},e.bindKeyboard=function(){var b,c=a.keyboard.builtLayouts[e.layout];e.$preview.unbind("keypress keyup keydown mouseup touchend ".split(" ").join(".keyboard ")).bind("keypress.keyboard",function(f){if(d.lockInput)return!1;var g,h=e.last.key=String.fromCharCode(f.charCode||f.which);if(e.$lastKey=[],e.checkCaret&&(g=e.$preview.caret(),e.last.start=g.start,e.last.end=g.end),e.capsLock=h>=65&&90>=h&&!f.shiftKey||h>=97&&122>=h&&f.shiftKey?!0:!1,d.restrictInput){if((8===f.which||0===f.which)&&a.inArray(f.keyCode,e.alwaysAllowed))return;-1===a.inArray(h,c.acceptedKeys)&&(f.preventDefault(),b=a.extend({},f),b.type="restricted",e.$el.trigger(b,[e,e.el]),a.isFunction(d.restricted)&&d.restricted(b,e,e.el))}else if((f.ctrlKey||f.metaKey)&&(97===f.which||99===f.which||118===f.which||120<=f.which&&122>=f.which))return;c.hasMappedKeys&&c.mappedKeys.hasOwnProperty(h)&&(e.last.key=c.mappedKeys[h],e.insertText(e.last.key),f.preventDefault()),e.checkMaxLength()}).bind("keyup.keyboard",function(b){switch(b.which){case 9:if(e.tab&&d.tabNavigation&&!d.lockInput){if(e.shiftActive=b.shiftKey,b=a.keyboard.keyaction.tab(e),e.tab=!1,!b)return!1}else b.preventDefault();break;case 27:return e.close(),!1}return clearTimeout(e.throttled),e.throttled=setTimeout(function(){e.isVisible()&&e.checkCombos()},100),e.checkMaxLength(),e.$el.trigger("change.keyboard",[e,e.el]),e.last.val=e.$preview.val(),a.isFunction(d.change)?(d.change(a.Event("change"),e,e.el),!1):void 0}).bind("keydown.keyboard",function(b){switch(b.which){case 8:a.keyboard.keyaction.bksp(e,null,b),b.preventDefault();break;case 9:return e.tab=!0,!1;case 13:a.keyboard.keyaction.enter(e,null,b);break;case 20:e.shiftActive=e.capsLock=!e.capsLock,e.showKeySet(this);break;case 86:if(b.ctrlKey||b.metaKey){if(d.preventPaste){b.preventDefault();break}e.checkCombos()}}}).bind("mouseup.keyboard touchend.keyboard",function(){if(e.checkCaret){var a=e.$preview.caret();e.last.start=a.start,e.last.end=a.end}}),e.$keyboard.bind("mousedown.keyboard click.keyboard touchstart.keyboard",function(b){b.stopPropagation(),e.isCurrent()||(e.reveal(),a(document).trigger("checkkeyboard.keyboard"))}),d.preventPaste&&(e.$preview.bind("contextmenu.keyboard",function(a){a.preventDefault()}),e.$el.bind("contextmenu.keyboard",function(a){a.preventDefault()}))},e.bindKeys=function(){var b=(d.keyBinding+" repeater mouseenter mouseleave touchstart mousewheel mouseup click ").split(" ").join(".keyboard ")+"mouseleave.kb mousedown.kb touchstart.kb touchend.kb touchmove.kb touchcancel.kb ";e.$allKeys=e.$keyboard.find("button.ui-keyboard-button").unbind(b).bind(d.keyBinding.split(" ").join(".keyboard ")+".keyboard repeater.keyboard",function(b){if(b.preventDefault(),!e.$keyboard.is(":visible"))return!1;var c,f,g,h=this;f=a(h),g=e.getLayers(f);var i=g.map(function(){return a(this).attr("data-curtxt")}).get(),i=(new Date).getTime();if(g.each(function(a,b){return b===h?(c=a,!1):void 0}),g=0>c?f:g.eq(c+f.data("curnum")),f=g.attr("data-action"),f=":"===f?":":f.split(":")[0],!(i-(e.last.eventTime||0)<d.preventDoubleEventTime)){if(e.last.eventTime=i,e.$preview.focus(),e.$lastKey=g,e.last.key=g.attr("data-curtxt"),e.checkCaret&&e.$preview.caret(e.last),f.match("meta")&&(f="meta"),a.keyboard.keyaction.hasOwnProperty(f)&&a(this).hasClass("ui-keyboard-actionkey")){if(!1===a.keyboard.keyaction[f](e,this,b))return!1}else"undefined"!=typeof f&&(i=e.last.key=e.wheel&&!a(this).hasClass("ui-keyboard-actionkey")?e.last.key:f,e.insertText(i),e.capsLock||d.stickyShift||b.shiftKey||(e.shiftActive=!1,e.showKeySet(this)));if(e.$preview.focus().caret(e.last),e.checkCombos(),e.checkMaxLength(),e.$el.trigger("change.keyboard",[e,e.el]),e.last.val=e.$preview.val(),a.isFunction(d.change))return d.change(a.Event("change"),e,e.el),!1}}).bind("mouseenter.keyboard mouseleave.keyboard touchstart.keyboard",function(b){if(e.isCurrent()){var c=a(this),f=e.getLayers(c),g=(f.length?f.map(function(){return a(this).attr("data-curtxt")||""}).get():"")||[c.find(".ui-keyboard-text").text()];"mouseenter"!==b.type&&"touchstart"!==b.type||"password"===e.el.type||c.hasClass(d.css.buttonDisabled)||c.addClass(d.css.buttonHover).attr("title",function(a,c){return e.wheel&&""===c&&e.sets&&1<g.length&&"touchstart"!==b.type?d.wheelMessage:c}),"mouseleave"===b.type&&(c.data({curtxt:c.data("original"),curnum:0}),c.removeClass("password"===e.el.type?"":d.css.buttonHover).attr("title",function(a,b){return b===d.wheelMessage?"":b}).find(".ui-keyboard-text").html(c.data("original")))}}).bind("mouseup.keyboard mouseleave.kb touchend.kb touchmove.kb touchcancel.kb",function(b){return/(mouseleave|touchend|touchcancel)/i.test(b.type)?a(this).removeClass(d.css.buttonHover):(e.isVisible()&&e.isCurrent()&&e.$preview.focus(),e.checkCaret&&e.$preview.caret(e.last)),e.mouseRepeat=[!1,""],clearTimeout(e.repeater),!1}).bind("click.keyboard",function(){return!1}).not(".ui-keyboard-actionkey").bind("mousewheel.keyboard",function(b,c){if(e.wheel){c=c||b.deltaY;var d,f=a(this);d=e.getLayers(f);var g=d.length&&d.map(function(){return a(this).attr("data-curtxt")}).get()||[f.find(".ui-keyboard-text").text()];return 1<g.length?(d=f.data("curnum")+(c>0?-1:1),d>g.length-1&&(d=0),0>d&&(d=g.length-1)):d=0,f.data({curnum:d,layers:g,curtxt:g[d]}),f.find(".ui-keyboard-text").html(g[d]),!1}}).add(".ui-keyboard-tab, .ui-keyboard-bksp, .ui-keyboard-space, .ui-keyboard-enter",e.$keyboard).bind("mousedown.kb touchstart.kb",function(){if(0!==d.repeatRate){var b=a(this);e.mouseRepeat=[!0,b],setTimeout(function(){e.mouseRepeat[0]&&e.mouseRepeat[1]===b&&e.repeatKey(b)},d.repeatDelay)}return!1})},e.insertText=function(a){var b,c;c=e.$preview.val();var d=e.$preview.caret(),f=e.$preview.scrollLeft();b=e.$preview.scrollTop();var g=c.length;d.end<d.start&&(d.end=d.start),d.start>g&&(d.end=d.start=g),"TEXTAREA"===e.preview.tagName&&(e.msie&&"\n"===c.substr(d.start,1)&&(d.start+=1,d.end+=1),c=c.split("\n").length-1,e.preview.scrollTop=c>0?e.lineHeight*c:b),b="bksp"===a&&d.start===d.end?!0:!1,a="bksp"===a?"":a,c=d.start+(b?-1:a.length),f+=parseInt(e.$preview.css("fontSize"),10)*("bksp"===a?-1:1),e.$preview.val(e.$preview.val().substr(0,d.start-(b?1:0))+a+e.$preview.val().substr(d.end)).scrollLeft(f).caret(c,c),e.last.start=e.last.end=c},e.checkMaxLength=function(){var a,b,c=e.$preview.val();!1!==d.maxLength&&c.length>d.maxLength&&(a=e.$preview.caret().start,b=Math.min(a,d.maxLength),d.maxInsert||(c=e.last.val,b=a-1),e.$preview.val(c.substring(0,d.maxLength)),e.$preview.caret(b,b),e.last.start=e.last.end=b),e.$decBtn.length&&e.checkDecimal()},e.repeatKey=function(a){a.trigger("repeater.keyboard"),e.mouseRepeat[0]&&(e.repeater=setTimeout(function(){e.repeatKey(a)},e.repeatTime))},e.showKeySet=function(a){var b="",c=(e.shiftActive?1:0)+(e.altActive?2:0);e.shiftActive||(e.capsLock=!1),e.metaActive?(b=a&&a.name&&/meta/i.test(a.name)?a.name:"",""===b?b=!0===e.metaActive?"":e.metaActive:e.metaActive=b,(!d.stickyShift&&e.last.keyset[2]!==e.metaActive||(e.shiftActive||e.altActive)&&!e.$keyboard.find(".ui-keyboard-keyset-"+b+e.rows[c]).length)&&(e.shiftActive=e.altActive=!1)):!d.stickyShift&&e.last.keyset[2]!==e.metaActive&&e.shiftActive&&(e.shiftActive=e.altActive=!1),c=(e.shiftActive?1:0)+(e.altActive?2:0),b=0!==c||e.metaActive?""===b?"":"-"+b:"-normal",e.$keyboard.find(".ui-keyboard-keyset"+b+e.rows[c]).length?(e.$keyboard.find(".ui-keyboard-alt, .ui-keyboard-shift, .ui-keyboard-actionkey[class*=meta]").removeClass(d.css.buttonAction).end().find(".ui-keyboard-alt")[e.altActive?"addClass":"removeClass"](d.css.buttonAction).end().find(".ui-keyboard-shift")[e.shiftActive?"addClass":"removeClass"](d.css.buttonAction).end().find(".ui-keyboard-lock")[e.capsLock?"addClass":"removeClass"](d.css.buttonAction).end().find(".ui-keyboard-keyset").hide().end().find(".ui-keyboard-keyset"+b+e.rows[c]).show().end().find(".ui-keyboard-actionkey.ui-keyboard"+b).addClass(d.css.buttonAction),e.last.keyset=[e.shiftActive,e.altActive,e.metaActive]):(e.shiftActive=e.last.keyset[0],e.altActive=e.last.keyset[1],e.metaActive=e.last.keyset[2])},e.checkCombos=function(){if(!e.isVisible())return e.$preview.val();var b,c,f,g,h=e.$preview.val(),i=e.$preview.caret(),j=a.keyboard.builtLayouts[e.layout],k=h.length;if(i.end<i.start&&(i.end=i.start),i.start>k&&(i.end=i.start=k),e.msie&&"\n"===h.substr(i.start,1)&&(i.start+=1,i.end+=1),d.useCombos&&(e.msie?h=h.replace(e.regex,function(a,b,c){return d.combos.hasOwnProperty(b)?d.combos[b][c]||a:a}):e.$preview.length&&(f=i.start-(0<=i.start-2?2:0),e.$preview.caret(f,i.end),g=(e.$preview.caret().text||"").replace(e.regex,function(a,b,c){return d.combos.hasOwnProperty(b)?d.combos[b][c]||a:a}),e.$preview.val(e.$preview.caret().replace(g)),h=e.$preview.val())),d.restrictInput&&""!==h){for(f=h,c=j.acceptedKeys.length,b=0;c>b;b++)""!==f&&(g=j.acceptedKeys[b],0<=h.indexOf(g)&&(/[\[|\]|\\|\^|\$|\.|\||\?|\*|\+|\(|\)|\{|\}]/g.test(g)&&(g="\\"+g),f=f.replace(new RegExp(g,"g"),"")));""!==f&&(h=h.replace(f,""))}return i.start+=h.length-k,i.end+=h.length-k,e.$preview.val(h),e.$preview.caret(i.start,i.end),e.preview.scrollTop=e.lineHeight*(h.substring(0,i.start).split("\n").length-1),e.last.start=i.start,e.last.end=i.end,d.acceptValid&&e.checkValid(),h},e.checkValid=function(){var a=!0;d.validate&&"function"==typeof d.validate&&(a=d.validate(e,e.$preview.val(),!1)),e.$keyboard.find(".ui-keyboard-accept")[a?"removeClass":"addClass"]("ui-keyboard-invalid-input")[a?"addClass":"removeClass"]("ui-keyboard-valid-input")},e.checkDecimal=function(){e.decimal&&/\./g.test(e.preview.value)||!e.decimal&&/\,/g.test(e.preview.value)?e.$decBtn.attr({disabled:"disabled","aria-disabled":"true"}).removeClass(d.css.buttonDefault+" "+d.css.buttonHover).addClass(d.css.buttonDisabled):e.$decBtn.removeAttr("disabled").attr({"aria-disabled":"false"}).addClass(d.css.buttonDefault).removeClass(d.css.buttonDisabled)},e.getLayers=function(b){var c=b.attr("data-pos");return b.closest(".ui-keyboard").find('button[data-pos="'+c+'"]').filter(function(){return""!==a(this).find(".ui-keyboard-text").text()})},e.switchInput=function(b,c){if("function"==typeof d.switchInput)d.switchInput(e,b,c);else{e.$keyboard.length&&e.$keyboard.hide();var f;f=!1;var g=a("button, input, textarea, a").filter(":visible").not(":disabled"),h=g.index(e.$el)+(b?1:-1);if(e.$keyboard.length&&e.$keyboard.show(),h>g.length-1&&(f=d.stopAtEnd,h=0),0>h&&(f=d.stopAtEnd,h=g.length-1),!f){if(c=e.close(c),!c)return;(f=g.eq(h).data("keyboard"))&&f.options.openOn.length?f.focusOn():g.eq(h).focus()}}return!1},e.close=function(b){if(e.isOpen){clearTimeout(e.throttled);var c=b?e.checkCombos():e.originalContent;if(b&&d.validate&&"function"==typeof d.validate&&!d.validate(e,c,!0)&&(c=e.originalContent,b=!1,d.cancelClose))return;e.isCurrent(!1),e.isOpen=!1,e.$preview.val(c),e.$el.removeClass("ui-keyboard-input-current ui-keyboard-autoaccepted").addClass(b?!0===b?"":"ui-keyboard-autoaccepted":"").trigger(d.alwaysOpen?"":"beforeClose.keyboard",[e,e.el,b||!1]).val(c).scrollTop(e.el.scrollHeight).trigger(b?"accepted.keyboard":"canceled.keyboard",[e,e.el]).trigger(d.alwaysOpen?"inactive.keyboard":"hidden.keyboard",[e,e.el]).blur(),d.openOn&&(e.timer=setTimeout(function(){e.$el.bind(d.openOn+".keyboard",function(){e.focusOn()}),a(":focus")[0]===e.el&&e.$el.blur()},500)),!d.alwaysOpen&&e.$keyboard&&(e.$keyboard.remove(),e.$keyboard=[]),e.watermark||""!==e.el.value||""===e.inPlaceholder||e.$el.addClass("ui-keyboard-placeholder").val(e.inPlaceholder),e.$el.trigger("change")}return!!b},e.accept=function(){return e.close(!0)},e.escClose=function(a){return a&&"keyup"===a.type?27===a.which?e.close():"":void(e.isOpen&&(!e.isCurrent()&&e.isOpen||e.isOpen&&a.target!==e.el&&!d.stayOpen)&&(e.allie&&a.preventDefault(),e.close(d.autoAccept?"true":!1)))},e.keyBtn=a("<button />").attr({role:"button",type:"button","aria-disabled":"false",tabindex:"-1"}).addClass("ui-keyboard-button"),e.addKey=function(b,c,f){var g,h,i,j=c.split(":"),k=j.length-1;c=!0===f?b:d.display[j[0]]||b;var l=!0===f?b.charCodeAt(0):b;return/\(.+\)/.test(c)&&(h=c.replace(/\(([^()]+)\)/,""),g=c.match(/\(([^()]+)\)/)[1],c=h,i=h.split(":"),h=""!==i[0]&&1<i.length?i[0]:h,a.keyboard.builtLayouts[e.layout].mappedKeys[g]=h),i=c.split(":"),""===i[0]&&""===i[1]&&(c=":"),c=""!==i[0]&&1<i.length?i[0]:c,c=a.trim(f?c:j[1]||c),g=1<i.length?a.trim(i[1]).replace(/_/g," ")||"":k>0?j[k]||"":"",h=2<c.length?" ui-keyboard-widekey":"",h+=f?"":" ui-keyboard-actionkey",e.keyBtn.clone().attr({"data-value":c,name:l,"data-pos":e.temp[1]+","+e.temp[2],title:g,"data-action":b,"data-original":c,"data-curtxt":c,"data-curnum":0}).addClass((""===l?"":"ui-keyboard-"+l+h+" ")+d.css.buttonDefault).html('<span class="ui-keyboard-text">'+c+"</span>").appendTo(e.temp[0])},e.customHash=function(){var a,b,c,e;b=d.customLayout,c=[];var f=[];for(a in b)b.hasOwnProperty(a)&&c.push(b[a]);if(f=f.concat.apply(f,c).join(" "),b=0,e=f.length,0===e)return b;for(a=0;e>a;a++)c=f.charCodeAt(a),b=(b<<5)-b+c,b&=b;return b},e.buildKeyboard=function(){a.isEmptyObject(d.display)&&e.updateLanguage();var b,c,f,g,h,i,j,k,l,m=0,n=a.keyboard.builtLayouts[e.layout]={mappedKeys:{},acceptedKeys:[]},o=n.acceptedKeys=[],p=a("<div />").addClass("ui-keyboard "+d.css.container+(d.alwaysOpen?" ui-keyboard-always-open":"")).attr({role:"textbox"}).hide();return"custom"!==d.layout&&a.keyboard.layouts.hasOwnProperty(d.layout)||(d.layout="custom",a.keyboard.layouts.custom=d.customLayout||{normal:["{cancel}"]}),a.each(a.keyboard.layouts[d.layout],function(n,q){var r;if(""!==n&&!/^(name|lang|rtl)$/i.test(n))for("default"===n&&(n="normal"),m++,g=a("<div />").attr("name",n).addClass("ui-keyboard-keyset ui-keyboard-keyset-"+n).appendTo(p)["normal"===n?"show":"hide"](),f=0;f<q.length;f++){for(i=a.trim(q[f]).replace(/\{(\.?)[\s+]?:[\s+]?(\.?)\}/g,"{$1:$2}"),k=i.split(/\s+/),j=0;j<k.length;j++)if(e.temp=[g,f,j],h=!1,0!==k[j].length)if(/^\{\S+\}$/.test(k[j]))if(c=k[j].match(/^\{(\S+)\}$/)[1],/\!\!/.test(c)&&(c=c.replace("!!",""),h=!0),/^sp:((\d+)?([\.|,]\d+)?)(em|px)?$/i.test(c)&&(l=parseFloat(c.replace(/,/,".").match(/^sp:((\d+)?([\.|,]\d+)?)(em|px)?$/i)[1]||0),a('<span class="ui-keyboard-text">&nbsp;</span>').width(c.match(/px/i)?l+"px":2*l+"em").addClass("ui-keyboard-button ui-keyboard-spacer").appendTo(g)),/^empty(:((\d+)?([\.|,]\d+)?)(em|px)?)?$/i.test(c)&&(l=/:/.test(c)?parseFloat(c.replace(/,/,".").match(/^empty:((\d+)?([\.|,]\d+)?)(em|px)?$/i)[1]||0):"",e.addKey(""," ").addClass(d.css.buttonDisabled+" "+d.css.buttonEmpty).attr("aria-disabled",!0).width(l?c.match("px")?l+"px":2*l+"em":"")),/^meta\d+\:?(\w+)?/i.test(c))e.addKey(c.split(":")[0],c);else switch(r=c.split(":"),r[0].toLowerCase()){case"a":case"accept":e.addKey("accept",c).addClass(d.css.buttonAction);break;case"alt":case"altgr":e.addKey("alt",c);break;case"b":case"bksp":e.addKey("bksp",c);break;case"c":case"cancel":e.addKey("cancel",c).addClass(d.css.buttonAction);break;case"combo":e.addKey("combo",c).addClass(d.css.buttonAction);break;case"dec":o.push(e.decimal?".":","),e.addKey("dec",c);break;case"e":case"enter":e.addKey("enter",c).addClass(d.css.buttonAction);break;case"s":case"shift":e.addKey("shift",c);break;case"sign":o.push("-"),e.addKey("sign",c);break;case"space":o.push(" "),e.addKey("space",c);break;case"t":case"tab":e.addKey("tab",c);break;default:a.keyboard.keyaction.hasOwnProperty(r[0])&&e.addKey(r[0],c)[h?"addClass":"removeClass"](d.css.buttonAction)}else b=k[j],o.push(":"===b?b:b.split(":")[0]),e.addKey(b,b,!0);g.find(".ui-keyboard-button:last").after('<br class="ui-keyboard-button-endrow">')}}),m>1&&(e.sets=!0),n.hasMappedKeys=!a.isEmptyObject(n.mappedKeys),n.$keyboard=p},e.destroy=function(){a(document).unbind("mousedown.keyboard keyup.keyboard touchstart.keyboard"),e.$keyboard.length&&e.$keyboard.remove();var b=a.trim(d.openOn+" accepted beforeClose canceled change contextmenu hidden initialized keydown keypress keyup visible ").split(" ").join(".keyboard ");e.$el.removeClass("ui-keyboard-input ui-keyboard-lockedinput ui-keyboard-placeholder ui-keyboard-notallowed ui-keyboard-always-open "+d.css.input).removeAttr("aria-haspopup").removeAttr("role").unbind(b+".keyboard").removeData("keyboard")},e.init()},a.keyboard.keyaction={accept:function(a){return a.close(!0),!1},alt:function(a,b){a.altActive=!a.altActive,a.showKeySet(b)},bksp:function(a){a.insertText("bksp")},cancel:function(a){return a.close(),!1},clear:function(a){a.$preview.val("")},combo:function(a){var b=!a.options.useCombos;return a.options.useCombos=b,a.$keyboard.find(".ui-keyboard-combo").toggleClass(a.options.css.buttonAction,b),b&&a.checkCombos(),!1},dec:function(a){a.insertText(a.decimal?".":",")},"default":function(a,b){a.shiftActive=a.altActive=a.metaActive=!1,a.showKeySet(b)},enter:function(b,c,d){c=b.el.tagName;var e=b.options;return d.shiftKey?e.enterNavigation?b.switchInput(!d[e.enterMod],!0):b.close(!0):e.enterNavigation&&("TEXTAREA"!==c||d[e.enterMod])?b.switchInput(!d[e.enterMod],e.autoAccept?"true":!1):void("TEXTAREA"===c&&a(d.target).closest("button").length&&b.insertText(" \n"))},lock:function(a,b){a.last.keyset[0]=a.shiftActive=a.capsLock=!a.capsLock,a.showKeySet(b)},left:function(a){var b=a.$preview.caret();0<=b.start-1&&(a.last.start=a.last.end=b.start-1)},meta:function(b,c){b.metaActive=a(c).hasClass(b.options.css.buttonAction)?!1:!0,b.showKeySet(c)},next:function(a){return a.switchInput(!0,a.options.autoAccept),!1},prev:function(a){return a.switchInput(!1,a.options.autoAccept),!1},right:function(a){var b=a.$preview.caret();b.start+1<=a.$preview.val().length&&(a.last.start=a.last.end=b.start+1)},shift:function(a,b){a.last.keyset[0]=a.shiftActive=!a.shiftActive,a.showKeySet(b)},sign:function(a){/^\-?\d*\.?\d*$/.test(a.$preview.val())&&a.$preview.val(-1*a.$preview.val())},space:function(a){a.insertText(" ")},tab:function(a){var b=a.options;return"INPUT"===a.el.tagName?b.tabNavigation?a.switchInput(!a.shiftActive,!0):!1:void a.insertText("	")}},a.keyboard.builtLayouts={},a.keyboard.layouts={alpha:{normal:["` 1 2 3 4 5 6 7 8 9 0 - = {bksp}","{tab} a b c d e f g h i j [ ] \\","k l m n o p q r s ; ' {enter}","{shift} t u v w x y z , . / {shift}","{accept} {space} {cancel}"],shift:["~ ! @ # $ % ^ & * ( ) _ + {bksp}","{tab} A B C D E F G H I J { } |",'K L M N O P Q R S : " {enter}',"{shift} T U V W X Y Z < > ? {shift}","{accept} {space} {cancel}"]},qwerty:{normal:["` 1 2 3 4 5 6 7 8 9 0 - = {bksp}","{tab} q w e r t y u i o p [ ] \\","a s d f g h j k l ; ' {enter}","{shift} z x c v b n m , . / {shift}","{accept} {space} {cancel}"],shift:["~ ! @ # $ % ^ & * ( ) _ + {bksp}","{tab} Q W E R T Y U I O P { } |",'A S D F G H J K L : " {enter}',"{shift} Z X C V B N M < > ? {shift}","{accept} {space} {cancel}"]},international:{normal:["` 1 2 3 4 5 6 7 8 9 0 - = {bksp}","{tab} q w e r t y u i o p [ ] \\","a s d f g h j k l ; ' {enter}","{shift} z x c v b n m , . / {shift}","{accept} {alt} {space} {alt} {cancel}"],shift:["~ ! @ # $ % ^ & * ( ) _ + {bksp}","{tab} Q W E R T Y U I O P { } |",'A S D F G H J K L : " {enter}',"{shift} Z X C V B N M < > ? {shift}","{accept} {alt} {space} {alt} {cancel}"],alt:["~ ¡ ² ³ ¤ € ¼ ½ ¾ ‘ ’ ¥ × {bksp}","{tab} ä å é ® þ ü ú í ó ö « » ¬","á ß ð f g h j k ø ¶ ´ {enter}","{shift} æ x © v b ñ µ ç > ¿ {shift}","{accept} {alt} {space} {alt} {cancel}"],"alt-shift":["~ ¹ ² ³ £ € ¼ ½ ¾ ‘ ’ ¥ ÷ {bksp}","{tab} Ä Å É ® Þ Ü Ú Í Ó Ö « » ¦","Ä § Ð F G H J K Ø ° ¨ {enter}","{shift} Æ X ¢ V B Ñ µ Ç . ¿ {shift}","{accept} {alt} {space} {alt} {cancel}"]},colemak:{normal:["` 1 2 3 4 5 6 7 8 9 0 - = {bksp}","{tab} q w f p g j l u y ; [ ] \\","{bksp} a r s t d h n e i o ' {enter}","{shift} z x c v b k m , . / {shift}","{accept} {space} {cancel}"],shift:["~ ! @ # $ % ^ & * ( ) _ + {bksp}","{tab} Q W F P G J L U Y : { } |",'{bksp} A R S T D H N E I O " {enter}',"{shift} Z X C V B K M < > ? {shift}","{accept} {space} {cancel}"]},dvorak:{normal:["` 1 2 3 4 5 6 7 8 9 0 [ ] {bksp}","{tab} ' , . p y f g c r l / = \\","a o e u i d h t n s - {enter}","{shift} ; q j k x b m w v z {shift}","{accept} {space} {cancel}"],shift:["~ ! @ # $ % ^ & * ( ) { } {bksp}",'{tab} " < > P Y F G C R L ? + |',"A O E U I D H T N S _ {enter}","{shift} : Q J K X B M W V Z {shift}","{accept} {space} {cancel}"]},num:{normal:"= ( ) {b};{clear} / * -;7 8 9 +;4 5 6 {sign};1 2 3 %;0 {dec} {a} {c}".split(";")}},a.keyboard.language=a.extend({},a.keyboard.language,{en:{display:{a:"✔:Accept (Shift-Enter)",accept:"Accept:Accept (Shift-Enter)",alt:"Alt:⌥ AltGr",b:"⌫:Backspace",bksp:"Bksp:Backspace",c:"✖:Cancel (Esc)",cancel:"Cancel:Cancel (Esc)",clear:"C:Clear",combo:"ö:Toggle Combo Keys",dec:".:Decimal",e:"⏎:Enter",empty:" ",enter:"Enter:Enter ⏎",left:"←",lock:"Lock:⇪ Caps Lock",next:"Next ⇨",prev:"⇦ Prev",right:"→",s:"⇧:Shift",shift:"Shift:Shift",sign:"±:Change Sign",space:"&nbsp;:Space",t:"⇥:Tab",tab:"⇥ Tab:Tab"},wheelMessage:"Use mousewheel to see other keys",comboRegex:/([`\'~\^\"ao])([a-z])/gim,combos:{"`":{a:"à",A:"À",e:"è",E:"È",i:"ì",I:"Ì",o:"ò",O:"Ò",u:"ù",U:"Ù",y:"ỳ",Y:"Ỳ"},"'":{a:"á",A:"Á",e:"é",E:"É",i:"í",I:"Í",o:"ó",O:"Ó",u:"ú",U:"Ú",y:"ý",Y:"Ý"},'"':{a:"ä",A:"Ä",e:"ë",E:"Ë",i:"ï",I:"Ï",o:"ö",O:"Ö",u:"ü",U:"Ü",y:"ÿ",Y:"Ÿ"},"^":{a:"â",A:"Â",e:"ê",E:"Ê",i:"î",I:"Î",o:"ô",O:"Ô",u:"û",U:"Û",y:"ŷ",Y:"Ŷ"},"~":{a:"ã",A:"Ã",e:"ẽ",E:"Ẽ",i:"ĩ",I:"Ĩ",o:"õ",O:"Õ",u:"ũ",U:"Ũ",y:"ỹ",Y:"Ỹ",n:"ñ",N:"Ñ"}}}}),a.keyboard.defaultOptions={language:null,rtl:!1,layout:"qwerty",customLayout:null,position:{of:null,my:"center top",at:"center top",at2:"center bottom"},reposition:!0,usePreview:!0,alwaysOpen:!1,initialFocus:!0,stayOpen:!1,css:{input:"ui-widget-content ui-corner-all",container:"ui-widget-content ui-widget ui-corner-all ui-helper-clearfix",buttonDefault:"ui-state-default ui-corner-all",buttonHover:"ui-state-hover",buttonAction:"ui-state-active",buttonDisabled:"ui-state-disabled",buttonEmpty:"ui-keyboard-empty"},autoAccept:!1,lockInput:!1,restrictInput:!1,acceptValid:!1,cancelClose:!0,tabNavigation:!1,enterNavigation:!1,enterMod:"altKey",stopAtEnd:!0,appendLocally:!1,appendTo:"body",stickyShift:!0,preventPaste:!1,caretToEnd:!1,maxLength:!1,maxInsert:!0,repeatDelay:500,repeatRate:20,resetDefault:!1,openOn:"focus",keyBinding:"mousedown touchstart",useCombos:!0,validate:function(){return!0}},a.keyboard.comboRegex=/([`\'~\^\"ao])([a-z])/gim,a.keyboard.currentKeyboard="",a.fn.keyboard=function(b){return this.each(function(){a(this).data("keyboard")||new a.keyboard(this,b)})},a.fn.getkeyboard=function(){return this.data("keyboard")}}(jQuery),function(a,b,c,d){a.fn.caret=function(a,e){if("undefined"==typeof this[0]||this.is(":hidden")||"hidden"===this.css("visibility"))return this;var f,g,h,i,j;j=document.selection;var k=this[0],l=k.scrollTop,m=!1,n=!0;try{m="selectionStart"in k}catch(o){n=!1}return"object"==typeof a&&"start"in a&&"end"in a?(g=a.start,i=a.end):"number"==typeof a&&"number"==typeof e&&(g=a,i=e),n&&"undefined"!=typeof g?(/(email|number)/i.test(k.type)||(m?(k.selectionStart=g,k.selectionEnd=i):(j=k.createTextRange(),j.collapse(!0),j.moveStart("character",g),j.moveEnd("character",i-g),j.select())),(this.is(":visible")||"hidden"!==this.css("visibility"))&&this.focus(),k.scrollTop=l,this):(/(email|number)/i.test(k.type)?f=h=this.val().length:m?(f=k.selectionStart,h=k.selectionEnd):j?"TEXTAREA"===k.tagName?(i=this.val(),g=j[c](),j=g[d](),j.moveToElementText(k),j.setEndPoint("EndToEnd",g),f=j.text.replace(/\r/g,"\n")[b],h=f+g.text.replace(/\r/g,"\n")[b]):(i=this.val().replace(/\r/g,"\n"),g=j[c]()[d](),g.moveEnd("character",i[b]),f=""===g.text?i[b]:i.lastIndexOf(g.text),g=j[c]()[d](),g.moveStart("character",-i[b]),h=g.text[b]):(f=0,h=(k.value||"").length),j=(k.value||"").substring(f,h),{start:f,end:h,text:j,replace:function(a){return k.value.substring(0,f)+a+k.value.substring(h,k.value[b])}})}}(jQuery,"length","createRange","duplicate");