<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="pl" lang="pl">
	<head>
		<meta http-equiv="Content-type" content="text/html; charset=utf-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7; IE=EmulateIE9" /> 
		<link rel="stylesheet" type="text/css" href="jquery-ui.css" />	
		<style type="text/css">
			body {
				background-color: #737173;
				position:absolute;
				top: 0px;
				bottom: 0px;
				height: 95%;
				width: 95%;
				text-align: center;
			}
			
			div {
				margin: 2em;
			}
			
			table {
				width: 100%;
				height: 100%;
			}
			
			#i_frame {
				text-align: left;
				background: white;
				height: 100%;
				width: 100%;
				overflow: auto;
			}
			
			.dane {
				color: blue;
			}
			.log {
				color: black;
			}
			.err {
				color: red;
			}
				
			#exec {
				width: 100%;
			}
		</style>
		<title>Node Server</title>
	</head>
	<body>
		<script type="text/javascript" src="jquery.min.js"></script>		
		<script type="text/javascript" src="jquery-ui.min.js"></script>
		<script type="text/javascript" src="socket.io-1.3.5.js"></script>
		<table><tbody>
			<tr>
				<td style="width:300px;">
					<div id="restart">Restart Node</div>
					<div id="exit">Wyłączenie Node</div>
					<div id="backup">Zapisanie zmian w TC (backup)</div>
					<div id="reboot">Reboot systemu</div>
					<div id="refresh">Odświerz przeglądarkę</div>
				</td>
				<td>
					<div id="i_frame">
						<div id="i_frame2">
						</div>
					</div>
				</td>
			</tr>
			<tr>
				<td colspan=2>
					<input type="text" id="exec"></input>
				</td>
			</tr>
		</tbody></table>
		<script type="text/javascript" >
			$(document).ready( function(){ 
				var socket = io();
				function append_text(msg, typ){
					// $('#i_frame').val($($('#i_frame').val() + JSON.stringify(msg)));
					$('#i_frame2').append($('<li class="'+typ+'">').html(msg));
					setTimeout(function () {
						$('#i_frame').scrollTop($('#i_frame2').height());
					}, 50);
				}
				socket.on('connect', function(msg){ append_text("Nawiązano połączenie", 'text'); });
//				socket.on('connect_timeout', function(msg){ append_text("connect_timeout", 'text'); });
				socket.on('connect_error', function(msg){ append_text("connect_error", 'text'); });
//				socket.on('reconnect_attempt', function(msg){ append_text("reconnect_attempt", 'text'); });
//				socket.on('reconnect_failed', function(msg){ append_text("reconnect_failed", 'text'); });
				socket.on('text', function(msg){ append_text(JSON.stringify(msg).replace(/\\n/g,"<br/>"), 'text'); });
				socket.on('dane', function(msg){ append_text(JSON.stringify(msg), 'dane'); });
				socket.on('log', function(msg){ append_text(JSON.stringify(msg), 'log'); });
				socket.on('err', function(msg){ append_text(JSON.stringify(msg), 'err'); });
				
				$('#restart').button().click(function(){	socket.emit('restart', 'restart'); });
				$('#exit'	).button().click(function(){	socket.emit('exit', 'exit'); });
				$('#reboot'	).button().click(function(){	socket.emit('exec', 'sudo reboot'); });
				$('#refresh').button().click(function(){	socket.emit('refresh', 'refresh'); });
				$('#backup'	).button().click(function(){	socket.emit('exec', 'filetool.sh -b'); });
				$('#exec').keypress(function (event) {
					if (event.which == 13) {
						socket.emit('exec', $('#exec').val());
						$('#exec').val('');
						//return false; only if needed
					}
				});
			});
		</script>
	</body>
</html>
