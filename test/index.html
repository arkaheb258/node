<!doctype html>
<html>
  <head>
    <title>Emiter</title>
    <link href="styleTest.css" rel="stylesheet" type="text/css" />
    <script src="jquery.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script>
      var daneDiag = {
        "sID": "BS_1",
        "DigitData": [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        "AnalogData": [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
      };

      var dane = {
        "komisja": "01H9001234",
        "wDataControl": 0,
        "wData": [0, 0, 0, 0, 0, 0],
        "Analog": [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 3, 0, 13, 0, 12, 10, 14854, 0, 31730, 7959, 14039, 0, 1355, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -32732, -8740, -26078, -4373, 10991, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -66],
        "Bit": [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 8192, 0, 0, 0, 0, 0, 0, 0, 14, 0, 2, 0, 26624, 0, 0, 0, 0, 0],
        "Mesg": [18755, 21586, 21589, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 32768, 256, 34334, 4067, 3, 0, 0, 0, 20, 0, 0, 0, 0, 0, 0, 944, 8, 0, 0, 0, 0, 0],
        "MesgType": [65375, 64510, 65471, 34815, 65531, 49151, 49151, 65535, 65533, 65535, 32703, 63455, 65534, 65535, 63423, 65535, 65534, 65534, 65023, 65535, 65503, 65399, 43007, 65535, 65533, 65343, 30719, 46591, 65462, 65535, 65535, 65535, 65535, 65461, 63487, 32767, 65515, 65471, 49151, 65535, 16379, 0],
        "MesgStatus": [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        "BlockUsr": [32607, 64256, 1168, 255, 65267, 48900, 1280, 766, 15357, 48961, 4353, 4319, 65406, 63264, 8480, 249, 49086, 42786, 16384, 2655, 64479, 65313, 40960, 383, 38909, 63232, 21504, 34047, 61366, 64320, 18451, 253, 64463, 64256, 16384, 2143, 57321, 48896, 515, 16759, 48123, 16128],
        "BlockSrvc": [6720, 62398, 60207, 1, 33026, 49143, 49150, 0, 1573, 32639, 32571, 40960, 256, 61439, 63167, 29184, 4200, 32766, 48633, 9024, 13059, 64375, 43007, 130, 24, 60735, 29631, 32, 528, 32765, 65531, 264, 18592, 48533, 63487, 9360, 35, 64439, 45055, 2, 2304, 19967],
        "BlockAdv": [64256, 24674, 4103, 1983, 29472, 268, 167, 65343, 64400, 65, 959, 30559, 65480, 2084, 8255, 65527, 65290, 33808, 3327, 65535, 48904, 24598, 115, 65530, 31488, 2, 24831, 46591, 65280, 49155, 735, 65535, 65284, 17, 4279, 32767, 61216, 12296, 4223, 65534, 65298, 16389]
      };
      var gpar = null;
      var socket = io();
      socket.emit('strada', 'bla');
      socket.on('dane', function(msg){
        // console.log(msg);
        dane = msg;
        document.getElementById("e_dane").checked = false;
        $('#dane').text(JSON.stringify(msg, null, 1));
        $('#t_dane').text(JSON.stringify(new Date()));
      });
      socket.on('gpar', function(msg){
        gpar = msg;
        var dane = msg.DANE;
        msg.DANE = null;
        $('#gpar').text(JSON.stringify(msg, null, 1));
        msg.DANE = dane;
        $('#t_gpar').text(JSON.stringify(new Date()));
      });
      socket.on('daneDiag', function(msg){
        // console.log('daneDiag', msg);
        daneDiag = msg;
        $('#daneDiag').text(JSON.stringify(msg, null, 1));
        $('#t_diag').text(JSON.stringify(new Date()));
      });
      setInterval(function(){
        dane.TimeStamp_js = Date.now();
        dane.TimeStamp_s = Math.floor(dane.TimeStamp_js / 1000);
        dane.TimeStamp_ms = dane.TimeStamp_js - (new Date()).setUTCHours(0, 0, 0, 0);
        if (document.getElementById("e_dane").checked) {
          $('#dane').text(JSON.stringify(dane, null, 1));
          socket.emit('broadcast', ['dane', dane]);
        }
        if (document.getElementById("e_diag").checked) {
          socket.emit('broadcast', ['daneDiag', daneDiag]);
        }
        $('#t_now').text(JSON.stringify(new Date()));
      }, 500);
    </script>
  </head>
  <body>
    <div class="ramkaGlowna"> ANALOG:
        <label for="anIndex">RamkaNr: </label>
        <input id="anIndex" class="klInput">

        <label for="anVal">Wartość: </label>
        <input id="anVal" class="klInput">

        <button id="anButton" class="klInput">Wyślij</button>
    </div>

    <div class="ramkaGlowna"> BIT:
        <label for="bitIndex">RamkaNr: </label>
        <input id="bitIndex" class="klInput">

        <label for="bitVal">Wartość: </label>
        <input id="bitVal" class="klInput">

        <button id="bitButton">Wyślij</button>
    </div>


    <div class="ramkaDiag"> DIAGNOSTYKA:
        <label for="diagIndex">RamkaNr: </label>
        <input id="diagIndex" class="klInput">

        <label for="diagVal">Wartość: </label>
        <input id="diagVal" class="klInput">

        <button id="diagButton">Wyślij</button>
    </div>
  </br>
  <input type="checkbox" id="e_dane" />Emit dane
  <input type="checkbox" id="e_diag" />Emit diag
  </br>
	<code id="dane">null</code></br></br>
	<code id="gpar">null</code></br></br>
	<code id="daneDiag">null</code></br></br>
	Czas: <span id="t_now"></span></br>
	Dane: <span id="t_dane"></span></br>
	GPar: <span id="t_gpar"></span></br>
	DDiag: <span id="t_diag"></span></br>
	<div id="gpar"></div>
  <script type="text/javascript" src="skrypt.js"></script>
  </body>
</html>