/*! Data kompilacji: Tue Jul 28 2015 11:01:42 */
define(["jquery","zmienneGlobalne","wspolne/brakPolTCP"],function(a,b,c){"use strict";var d,e,f=!1,g=0,h=0,i={timeStamp_s:0,timeStamp_ms:0,timeStamp_js:0,analog:[],bit:[],mesg:[],mesgType:[],mesgStatus:[],blockUser:[],blockSrvc:[],blockAdv:[]},j=function(){var c=function(a){var b,c=0,d=1;for(b=0;16>b;b+=1)a&d&&(c+=1),d<<=1;return c},d=function(a,c){var d,e=1;for(d=0;16>d;d+=1)a&e&&(i.mesgType[c]&e?b.komunikaty.ostrz+=1:b.komunikaty.alarmy+=1),e<<=1};b.blokady.zalUser=0,b.blokady.zalSrvc=0,b.blokady.zalAdv=0,a.each(i.blockUser,function(a,d){b.blokady.zalUser+=c(d)}),a.each(i.blockSrvc,function(a,d){b.blokady.zalSrvc+=c(d)}),a.each(i.blockAdv,function(a,d){b.blokady.zalAdv+=c(d)}),b.komunikaty.alarmy=0,b.komunikaty.ostrz=0,a.each(i.mesg,function(a,b){d(b,a)})},k=function(){var a;for(a=0;a<i.analog.length;a+=1)void 0!==i.analog[a]&&(i.analog[a]=0);for(a=0;a<i.bit.length;a+=1)void 0!==i.bit[a]&&(i.bit[a]=0);for(a=0;a<i.mesg.length;a+=1)void 0!==i.mesg[a]&&(i.mesg[a]=0)},l=function(){var e;f?0===g&&(g=setTimeout(function(){f=!1,e=b.danePlikuKonfiguracyjnego.TEKSTY.brakPolTCP1,a("#brakPolTCP1").text(e),a("#brakPolTCP2").text("Reset komunikacji..."),clearTimeout(g),g=0},3e3)):a.ajax({url:b.adresSerweraDane,timeout:3e3,type:"GET",dataType:"json",success:function(e){var f,g;if(e.error||e.ERROR)return k(),void(0===h&&(h=setTimeout(function(){g=b.danePlikuKonfiguracyjnego.TEKSTY.brakPolTCP2,c.inicjacja(g,e.error)},2e3)));if(0!==h&&(clearTimeout(h),h=0),a("#DialogBrakKomunikacjiTCP").length>0&&setTimeout(function(){a("#DialogBrakKomunikacjiTCP").hasClass("bladFtp")===!1&&a("#DialogBrakKomunikacjiTCP").dialog("close")},2e3),void 0===e.error&&void 0!==e.Analog){for(i.timeStamp_s=e.TimeStamp_s,i.timeStamp_ms=e.TimeStamp_ms,i.timeStamp_js=e.TimeStamp_js,f=e.Analog.length,d=0;f>d;d+=1)null===e.Analog[d]&&console.log("Brak danych w ramce - nr:"+d),i.analog[d]=Math.round(100*e.Analog[d])/100,null!==e.Bit[d]&&(i.bit[d]=e.Bit[d]),null!==e.Mesg[d]&&(i.mesg[d]=e.Mesg[d]),null!==e.MesgType[d]&&(i.mesgType[d]=e.MesgType[d]),null!==e.MesgStatus[d]&&(i.mesgStatus[d]=e.MesgStatus[d]),null!==e.BlockUsr[d]&&(i.blockUser[d]=e.BlockUsr[d]),null!==e.BlockSrvc[d]&&(i.blockSrvc[d]=e.BlockSrvc[d]),null!==e.BlockAdv[d]&&(i.blockAdv[d]=e.BlockAdv[d]);j()}},error:function(a,d,e){k(),console.log("błąd tcp, callback 'error', status: "+d),e=b.danePlikuKonfiguracyjnego.TEKSTY.brakPolTCP1,b.trwaZmianaCzasu===!1&&c.inicjacja(e,d),f=!0},complete:function(a,d){"timeot"===d&&(k(),console.log("błąd tcp, callback 'complete', status: "+d),e=b.danePlikuKonfiguracyjnego.TEKSTY.brakPolTCP1,b.trwaZmianaCzasu===!1&&c.inicjacja(e,d),f=!0)}})},m=function(){console.log("kommTCP - inicjacja"),e=setInterval(function(){l()},b.czasOdswiezaniaSerwer)};return{inicjacja:m,daneTCP:i}});