/*! Data kompilacji: Tue Jul 28 2015 11:01:42 */
define(["jquery","zmienneGlobalne","wspolne/brakPolTCP","socketio"],function(a,b,c,d){"use strict";var e=0,f=0,g=!1,h={timeStamp_s:0,timeStamp_ms:0,timeStamp_js:0,analog:[],bit:[],mesg:[],mesgType:[],mesgStatus:[],blockUser:[],blockSrvc:[],blockAdv:[]},i={sID:"",DigitData:[],AnalogData:[]},j=d(),k=function(){var c=function(a){var b,c=0,d=1;for(b=0;16>b;b+=1)a&d&&(c+=1),d<<=1;return c},d=function(a,c){var d,e=1;for(d=0;16>d;d+=1)a&e&&(h.mesgType[c]&e?b.komunikaty.ostrz+=1:b.komunikaty.alarmy+=1),e<<=1};b.blokady.zalUser=0,b.blokady.zalSrvc=0,b.blokady.zalAdv=0,a.each(h.blockUser,function(a,d){b.blokady.zalUser+=c(d)}),a.each(h.blockSrvc,function(a,d){b.blokady.zalSrvc+=c(d)}),a.each(h.blockAdv,function(a,d){b.blokady.zalAdv+=c(d)}),b.komunikaty.alarmy=0,b.komunikaty.ostrz=0,a.each(h.mesg,function(a,b){d(b,a)})},l=function(){var a;for(a=0;a<h.analog.length;a+=1)void 0!==h.analog[a]&&(h.analog[a]=0);for(a=0;a<h.bit.length;a+=1)void 0!==h.bit[a]&&(h.bit[a]=0);for(a=0;a<h.mesg.length;a+=1)void 0!==h.mesg[a]&&(h.mesg[a]=0);b.komunikaty.alarmy=0,b.komunikaty.ostrz=0},m=function(a){var c=[],d="",e=5e3;console.log(a),require(["progresBar"],function(f){f.inicjacja({show:!0,status:"sending"}),j.emit(a.ioEmit,a.ioMess),g||(g=!0,j.on(a.ioOn,function(a){switch(console.log(a),a){case"OK":case"error":f.inicjacja({status:"OK",info:"Zakończono pobieranie plików"}),c.unshift("Pobrano pliki:"),require(["alert"],function(a){a.inicjacja({texts:c,background:"ui-state-default",timer:e}),setTimeout(function(){a.inicjacja({texts:[b.danePlikuKonfiguracyjnego.TEKSTY.restart],timer:e,restart:!0})},e+1e3)});break;case"err":f.inicjacja({status:"error"});break;default:-1===a.search("flash")?d+=a+", ":(c.push(d),d="",c.push("--- KATALOG: "+a+" ---")),f.inicjacja({info:"Pobieram: "+a})}}))})},n=function(){var d,g,m=2e3,n=!1;setTimeout(function(){n||(d=b.danePlikuKonfiguracyjnego.TEKSTY.brakPolTCP1,c.inicjacja(d,"Brak inicjacji komunikacji z serwerem node"))},5e3),j.on("reconnecting",function(){console.log("socket.io - reconnecting"),d=b.danePlikuKonfiguracyjnego.TEKSTY.brakPolTCP1,c.inicjacja(d,"socket.io - reconnecting"),setTimeout(function(){c.inicjacja(d,"socket.io - disconnected")},1e3)}),j.on("connect",function(){console.log("socket.io - connected")}),j.on("disconnect",function(){console.log("socket.io - disconnected"),setTimeout(function(){l(),d=b.danePlikuKonfiguracyjnego.TEKSTY.brakPolTCP1,c.inicjacja(d,"socket.io - disconnected")},m)}),j.on("refresh",function(){location.reload()}),j.on("gpar",function(a){console.log("gpar - zmiana parametrow"),j.emit("getPar"),j.emit("getSyg"),require(["parametry/odswiez"],function(b){b.przeladuj(a)})}),j.on("actPar",function(a){b.parametry=a}),j.on("actSyg",function(a){b.sygnaly=a}),j.on("defPar",function(a){b.parametry=a}),j.on("defSyg",function(a){b.sygnaly=a}),j.on("daneDiag",function(a){i.DigitData=a.DigitData,i.AnalogData=a.AnalogData}),j.on("dane",function(i){n=!0,i.error||i.ERROR?g?a("#DialogBrakKomunikacjiTCP").length>0&&c.inicjacja(d,i.error):(g=!0,e=setTimeout(function(){l(),d=b.danePlikuKonfiguracyjnego.TEKSTY.brakPolTCP2,c.inicjacja(d,i.error)},m)):(g=!1,clearTimeout(e),a("#DialogBrakKomunikacjiTCP").length>0&&setTimeout(function(){a("#DialogBrakKomunikacjiTCP").dialog("close")},2e3)),clearTimeout(f),f=setTimeout(function(){l(),j.connected&&(d=b.danePlikuKonfiguracyjnego.TEKSTY.brakPolTCP1,c.inicjacja(d,"Brak danych z serwera Node"))},m+3e3),void 0===i.error&&void 0!==i.Analog&&(h.timeStamp_s=i.TimeStamp_s,h.timeStamp_ms=i.TimeStamp_ms,h.timeStamp_js=i.TimeStamp_js,h.analog=i.Analog,h.bit=i.Bit,h.mesg=i.Mesg,h.mesgType=i.MesgType,h.mesgStatus=i.MesgStatus,h.blockUser=i.BlockUsr,h.blockSrvc=i.BlockSrvc,h.blockAdv=i.BlockAdv,k())})},o=function(){n()};return{inicjacja:o,daneTCP:h,daneDiag:i,socket:j,rozkazSIO:m}});